# 🧪 Devnet Testing Guide - Cerberus Phoenix v2.0

## 🎯 Overview

This guide covers comprehensive testing of Cerberus Phoenix v2.0 on **Solana Devnet** - a safe testing environment that allows real blockchain interactions without risking actual funds.

## 🌐 **Why Devnet Testing?**

### **Benefits of Devnet**
- ✅ **Real Blockchain Environment** - Actual Solana network behavior
- ✅ **Free Test SOL** - No cost for transactions and testing
- ✅ **Safe Testing** - No risk to real funds or mainnet operations
- ✅ **Full Feature Testing** - All Solana features available
- ✅ **Webhook Integration** - Real-time event testing with Helius

### **What We Test**
- **Webhook Processing** - Real-time token event handling
- **AI Decision Making** - Trading signal generation and risk assessment
- **Multi-RPC Integration** - Provider failover and optimization
- **System Performance** - Latency, throughput, and reliability
- **Error Handling** - Graceful degradation and recovery

## 🚀 **Quick Start**

### **Prerequisites**
```bash
# System requirements
- Docker & Docker Compose
- 8GB RAM minimum
- Stable internet connection
- 10GB free disk space

# Optional but recommended
- Solana CLI (auto-installed by script)
- jq for JSON processing
- curl for API testing
```

### **1. Automated Devnet Testing**
```bash
# Run complete devnet testing suite
./scripts/devnet-testing.sh

# This will:
# - Install Solana CLI if needed
# - Create test wallet with SOL airdrop
# - Start all services in devnet mode
# - Run comprehensive tests
# - Monitor system performance
```

### **2. Manual Devnet Setup**
```bash
# Start devnet infrastructure
docker-compose -f infrastructure/docker-compose.devnet.yml up -d

# Check service status
docker-compose -f infrastructure/docker-compose.devnet.yml ps

# View logs
docker-compose -f infrastructure/docker-compose.devnet.yml logs -f
```

## 🔧 **Configuration**

### **Environment Variables (Devnet)**
```bash
# Network Configuration
SOLANA_NETWORK=devnet
SOLANA_RPC_URL=https://api.devnet.solana.com
SOLANA_WS_URL=wss://api.devnet.solana.com
SOLANA_COMMITMENT=confirmed

# Enhanced Logging for Testing
RUST_LOG=debug
DEVNET_TESTING=true

# Relaxed Limits for Testing
WEBHOOK_RATE_LIMIT=1000
API_RATE_LIMIT_MULTIPLIER=10

# Test Wallet Configuration
TEST_WALLET_PATH=./test-wallet.json
WALLET_ADDRESS=<auto-generated>
```

### **Service Endpoints (Devnet)**
- **HFT-Ninja**: `http://localhost:8090` - Webhook processing
- **Cerebro-BFF**: `http://localhost:8081` - AI analysis
- **Grafana**: `http://localhost:3001` - Monitoring (admin/devnet_admin)
- **Prometheus**: `http://localhost:9090` - Metrics collection
- **Kestra**: `http://localhost:8082` - Workflow orchestration
- **Qdrant**: `http://localhost:6333` - Vector database

## 🧪 **Testing Scenarios**

### **1. Webhook Integration Testing**
```bash
# Test large volume transfer detection
curl -X POST http://localhost:8090/webhooks/helius \
  -H "Authorization: Bearer devnet_test_token" \
  -H "Content-Type: application/json" \
  -d '{
    "events": [{
      "token_transfers": [{
        "token_amount": 50000.0,
        "mint": "DevnetTestToken123"
      }]
    }]
  }'

# Expected: Trading signal generation with high confidence
```

### **2. AI Decision Testing**
```bash
# Test risk analysis endpoint
curl "http://localhost:8081/api/v1/risk/analyze/So11111111111111111111111111111111111111112"

# Expected: Risk score and analysis for SOL token
```

### **3. Multi-RPC Testing**
```bash
# Test RPC provider status
curl "http://localhost:8081/api/v1/rpc/providers"

# Expected: Status of all configured RPC providers
```

### **4. Performance Testing**
```bash
# Load test webhook endpoint
for i in {1..100}; do
  curl -X POST http://localhost:8090/webhooks/helius \
    -H "Authorization: Bearer devnet_test_token" \
    -H "Content-Type: application/json" \
    -d '{"test": "load_test_'$i'"}' &
done

# Monitor metrics
curl "http://localhost:8090/webhooks/metrics"
```

## 📊 **Monitoring & Metrics**

### **Grafana Dashboards**
Access Grafana at `http://localhost:3001` (admin/devnet_admin):

- **Devnet Overview** - Main system metrics
- **Webhook Processing** - Real-time webhook performance
- **AI Analysis** - Trading signal generation
- **System Health** - Resource usage and errors

### **Key Metrics to Monitor**
```bash
# Webhook Processing
- Processing Rate: >10 webhooks/second
- Success Rate: >95%
- Latency P95: <50ms
- Error Rate: <5%

# AI Analysis
- Signal Generation: >1 signal/minute during testing
- Risk Detection: Appropriate risk scores
- Decision Latency: <100ms

# System Performance
- CPU Usage: <80%
- Memory Usage: <85%
- Disk Usage: <90%
```

### **Real-time Monitoring**
```bash
# Watch webhook metrics
watch -n 5 'curl -s http://localhost:8090/webhooks/metrics | jq .'

# Monitor system health
watch -n 10 'curl -s http://localhost:8081/api/v1/metrics/system-health | jq .'

# Check container status
watch -n 15 'docker-compose -f infrastructure/docker-compose.devnet.yml ps'
```

## 🎯 **Test Scenarios**

### **Scenario 1: New Token Launch Detection**
```bash
# Simulate pump.fun token creation
curl -X POST http://localhost:8090/webhooks/helius \
  -H "Authorization: Bearer devnet_test_token" \
  -d '{
    "events": [{
      "instructions": [{
        "program_id": "6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P"
      }]
    }]
  }'

# Expected Results:
# - New token signal generated
# - AI analysis triggered
# - Kestra workflow started
# - Risk assessment completed
```

### **Scenario 2: Wash Trading Detection**
```bash
# Simulate suspicious self-transfer
curl -X POST http://localhost:8090/webhooks/helius \
  -H "Authorization: Bearer devnet_test_token" \
  -d '{
    "events": [{
      "token_transfers": [{
        "from_user_account": "SameAccount123",
        "to_user_account": "SameAccount123",
        "token_amount": 10000.0
      }]
    }]
  }'

# Expected Results:
# - Risk indicator generated
# - High risk score assigned
# - Alert triggered
```

### **Scenario 3: High Volume Activity**
```bash
# Simulate whale activity
curl -X POST http://localhost:8090/webhooks/helius \
  -H "Authorization: Bearer devnet_test_token" \
  -d '{
    "events": [{
      "token_transfers": [{
        "token_amount": 1000000.0,
        "mint": "WhaleToken123"
      }]
    }]
  }'

# Expected Results:
# - Large volume signal
# - High confidence score
# - Immediate processing
```

## 🔍 **Debugging & Troubleshooting**

### **Common Issues**
1. **Services Not Starting**
   ```bash
   # Check Docker resources
   docker system df
   docker system prune -f
   
   # Restart services
   docker-compose -f infrastructure/docker-compose.devnet.yml restart
   ```

2. **Webhook Authentication Failures**
   ```bash
   # Check auth token configuration
   grep HELIUS_AUTH_TOKEN .env.devnet
   
   # Test with correct token
   curl -H "Authorization: Bearer devnet_test_token" \
        http://localhost:8090/webhooks/helius
   ```

3. **High Latency**
   ```bash
   # Check system resources
   docker stats
   
   # Monitor network connectivity
   ping api.devnet.solana.com
   ```

### **Debug Commands**
```bash
# View service logs
docker-compose -f infrastructure/docker-compose.devnet.yml logs hft-ninja-devnet
docker-compose -f infrastructure/docker-compose.devnet.yml logs cerebro-bff-devnet

# Check service health
curl http://localhost:8090/health
curl http://localhost:8081/health

# Monitor webhook processing
tail -f /var/log/webhook-processing.log

# Check Solana devnet connectivity
solana cluster-version --url https://api.devnet.solana.com
```

## 📈 **Performance Benchmarks**

### **Target Performance (Devnet)**
- **Webhook Processing**: <10ms average latency
- **Throughput**: >100 webhooks/second
- **Success Rate**: >99%
- **AI Decision Time**: <100ms
- **System Uptime**: >99.9%

### **Load Testing**
```bash
# Run comprehensive load test
./scripts/devnet-load-test.sh

# Custom load test
ab -n 1000 -c 10 \
   -H "Authorization: Bearer devnet_test_token" \
   -T "application/json" \
   -p test_payload.json \
   http://localhost:8090/webhooks/helius
```

## 🧹 **Cleanup**

### **Stop Testing Environment**
```bash
# Stop all devnet services
docker-compose -f infrastructure/docker-compose.devnet.yml down

# Remove volumes (optional)
docker-compose -f infrastructure/docker-compose.devnet.yml down -v

# Clean up test files
./scripts/devnet-testing.sh cleanup
```

### **Preserve Test Data**
```bash
# Keep test wallet for future use
cp test-wallet.json test-wallet-backup.json

# Export test results
docker-compose -f infrastructure/docker-compose.devnet.yml logs > devnet-test-logs.txt
```

## 🎯 **Success Criteria**

### **Testing Complete When:**
- ✅ All services start successfully
- ✅ Webhook processing <10ms average
- ✅ >95% webhook success rate
- ✅ AI decisions generated correctly
- ✅ Risk indicators detected appropriately
- ✅ No critical errors in logs
- ✅ System stable under load

### **Ready for Production When:**
- ✅ All devnet tests pass
- ✅ Performance meets targets
- ✅ Error handling works correctly
- ✅ Monitoring and alerting functional
- ✅ Documentation complete

## 🚀 **Next Steps After Devnet**

1. **Mainnet Preparation** - Configure production API keys
2. **Oracle Cloud Deployment** - Deploy to production infrastructure
3. **SSL Configuration** - Setup HTTPS endpoints
4. **Production Monitoring** - Configure alerts and dashboards
5. **Go Live** - Start real trading operations

---

**🧪 Safe testing environment for maximum confidence before production deployment**
